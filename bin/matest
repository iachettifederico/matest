#!/usr/bin/env ruby

require "time"
start_time = Time.now

if File.exist?(File.expand_path("./spec/", Dir.pwd))
  $LOAD_PATH.unshift(File.expand_path("./spec/", Dir.pwd))
end

if File.exist?(File.expand_path("./test/", Dir.pwd))
  $LOAD_PATH.unshift(File.expand_path("./test/", Dir.pwd))
end

require "matest"
require "rake"

pwd = Dir.pwd
runner = Matest::Runner.runner
Rake::FileList[ARGV].each do |file|
  runner.load_file(Pathname(file).expand_path.to_s)
end

runner.execute!

time_elapsed = Time.now - start_time

puts
info = runner.info

def spec_detail(info)
  info[:num_specs].map { |name, num|
    "  #{num} #{name.downcase}."
  }.join("\n")
end

good_bye_message = <<-EOF
------------------------------------------
Specs:
#{spec_detail(info)}

EOF

puts good_bye_message

time_elapsed = Time.now - start_time
puts "Elapsed: #{time_elapsed} seconds."


exit(1) unless info[:success]
